version: "3.9"

services:  
  db:
    image: mysql:latest
    container_name: db
    environment:
      MYSQL_DATABASE: ticktalk
      MYSQL_USER: gorm
      MYSQL_PASSWORD: ticktalk
      MYSQL_RANDOM_ROOT_PASSWORD: "yes"
    volumes:
      - $HOME/cdata/mysql:/var/lib/mysql
    ports:
      - "9910:3306"

  etcd:
    image: bitnami/etcd:latest
    container_name: etcd
    environment:
      ALLOW_NONE_AUTHENTICATION: "yes"
    ports:
      - "2379:2379"

  redis:
    image: redis:latest
    container_name: redis
    environment:
      REDIS_PASSWORD: ticktalk
    ports:
      - "6379:6379"

  user:
    build: ./user
    container_name: user
    depends_on:
      - db
      - redis
      - etcd
    ports:
      - "12001:12001"
    volumes:
      - $HOME/cdata/user:/data
  
  videomgr:
    build: ./videomgr
    container_name: videomgr
    depends_on:
      - db
      - redis
      - etcd
    ports:
      - "13001:13001"
    volumes:
      - $HOME/cdata/videomgr:/data

  mainapi:
    build: ./api
    container_name: mainapi
    depends_on:
      - user
      - videomgr
    ports:
      - "10001:10001"
    volumes:
      - $HOME/cdata/mainapi:/data
